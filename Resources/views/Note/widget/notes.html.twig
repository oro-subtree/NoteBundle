<div class="widget-content">
    {% include 'OroNoteBundle:Note:view.js.twig' %}

    <div class="widget-actions">
        {% if resource_granted('oro_note_create') %}
            <button class="btn btn-mini" type="button" data-action-name="add_note">{{ 'oro.note.action.add'|trans }}</button>
        {% endif %}
    </div>
    <div class="notes map-box" id="note-list"></div>

    <script type="text/javascript">
    require(['jquery', 'underscore', 'routing', 'oronote/js/note-list', 'oroui/js/widget-manager'],
    function($, _, routing, NoteList, widgetManager) {
        widgetManager.getWidgetInstance({{ app.request.get('_wid')|json_encode|raw }}, function(widget){
            /** @type oronote.NoteList */
            var noteList = new NoteList({
                el: '#note-list',
                labels: {
                    noData: {{ "oro.note.no_notes_exist"|trans|json_encode|raw }},
                    addDialogTitle: {{ "oro.note.add_note_title"|trans|json_encode|raw }},
                    editDialogTitle: {{ "oro.note.edit_note_title"|trans|json_encode|raw }},
                    itemSaved: {{ "oro.note.note_saved"|trans|json_encode|raw }},
                    deleteConfirmation: {{ "oro.note.note_delete_confirmation"|trans|json_encode|raw }}
                },
                listUrl: {{ path('oro_note_notes', {
                    'entityClass': oro_class_name(entity)|replace('\\', '_'),
                    'entityId': entity.id})|json_encode|raw
                }},
                createItemUrl: {{ path('oro_note_create', {
                    'entityClass': oro_class_name(entity)|replace('\\', '_'),
                    'entityId': entity.id})|json_encode|raw
                }},
                updateItemUrl: function(model) {
                    return routing.generate('oro_note_update', {'id': model.get('id')});
                },
                deleteItemUrl: function(model) {
                    return routing.generate('oro_api_delete_note', {'id': model.get('id')});
                }
            });
            widget.getAction('add_note', 'adopted', function(action) {
                action.on('click', _.bind(noteList.addItem, noteList));
            });
            noteList
                .getCollection()
                .reset({{ render(path('oro_note_notes', {
                    entityClass: oro_class_name(entity),
                    entityId: entity.id
                })) }});
        });
    });
    </script>
</div>
